#!/usr/bin/env bash
# Wrapper script for reviewed-patch that handles stdin piping properly

set -e

# Check if running with piped input
if [ ! -t 0 ]; then
  # Stdin is piped, save to temp file
  TMPFILE=$(mktemp)
  trap "rm -f '$TMPFILE'" EXIT

  # Read stdin to temp file
  cat > "$TMPFILE"

  # Run with --file option
  # Try to redirect stdin from /dev/tty for blessed (if available)
  if [ -r /dev/tty ]; then
    exec bun run "$(dirname "$0")/../src/index.ts" --file "$TMPFILE" "$@" < /dev/tty
  else
    # In test/non-interactive environments, /dev/tty may not be available
    # Just run without stdin redirection (tests handle this differently)
    exec bun run "$(dirname "$0")/../src/index.ts" --file "$TMPFILE" "$@"
  fi
else
  # No piped input, pass through arguments
  exec bun run "$(dirname "$0")/../src/index.ts" "$@"
fi
